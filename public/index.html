<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ¯ Kebapi - Generador de APIs con IA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .glow {
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.4);
        }
        .endpoint-card {
            transition: all 0.3s ease;
        }
        .endpoint-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white py-8 shadow-xl">
        <div class="container mx-auto px-4">
            <h1 class="text-5xl font-bold mb-2 text-center">ğŸŒ¯ Kebapi</h1>
            <p class="text-center text-xl opacity-90">Generador de APIs REST con Inteligencia Artificial</p>
            <div class="flex justify-center gap-4 mt-4">
                <span class="bg-white/20 px-3 py-1 rounded-full text-sm">âœ¨ IA Powered</span>
                <span class="bg-white/20 px-3 py-1 rounded-full text-sm">â˜ï¸ Supabase</span>
                <span class="bg-white/20 px-3 py-1 rounded-full text-sm">ğŸš€ Railway</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-12 max-w-6xl">
        <!-- Generator Section -->
        <div class="bg-white rounded-2xl shadow-lg p-8 mb-12 glow">
            <h2 class="text-3xl font-bold mb-6 gradient-text">âœ¨ Generar Nuevo Endpoint</h2>
            
            <div class="mb-6">
                <label class="block text-gray-700 font-semibold mb-2">
                    Describe el endpoint que necesitas:
                </label>
                <textarea 
                    id="promptInput"
                    class="w-full p-4 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 outline-none transition"
                    rows="4"
                    placeholder="Ejemplo: endpoint de pelÃ­culas de terror con tÃ­tulo, director, aÃ±o y calificaciÃ³n..."
                ></textarea>
                <p class="text-sm text-gray-500 mt-2">MÃ­nimo 10 caracteres</p>
            </div>

            <!-- Examples -->
            <div class="mb-6">
                <p class="text-sm font-semibold text-gray-600 mb-2">Ejemplos rÃ¡pidos:</p>
                <div class="flex flex-wrap gap-2">
                    <button onclick="setPrompt('endpoint de restaurantes con nombre, tipo de comida, direcciÃ³n y calificaciÃ³n')" 
                            class="bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-full text-sm transition">
                        ğŸ½ï¸ Restaurantes
                    </button>
                    <button onclick="setPrompt('API de productos tech con nombre, precio, marca y stock')" 
                            class="bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-full text-sm transition">
                        ğŸ’» Productos
                    </button>
                    <button onclick="setPrompt('endpoint de usuarios con nombre, email, edad y ciudad')" 
                            class="bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-full text-sm transition">
                        ğŸ‘¥ Usuarios
                    </button>
                    <button onclick="setPrompt('API de tareas pendientes con tÃ­tulo, descripciÃ³n, prioridad y estado')" 
                            class="bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-full text-sm transition">
                        âœ… Tareas
                    </button>
                </div>
            </div>

            <button 
                onclick="generarEndpoint()"
                id="generateBtn"
                class="w-full gradient-bg text-white font-bold py-4 px-6 rounded-lg hover:opacity-90 transition transform hover:scale-105 text-lg shadow-lg">
                ğŸŒ¯ Generar Endpoint con IA
            </button>

            <!-- Loading -->
            <div id="loading" class="hidden mt-6 text-center">
                <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-purple-500 border-t-transparent"></div>
                <p class="mt-3 text-gray-600 font-semibold">Cocinando tu endpoint con IA...</p>
            </div>

            <!-- Result -->
            <div id="result" class="hidden mt-6 p-6 bg-green-50 border-2 border-green-200 rounded-lg">
                <h3 class="font-bold text-green-800 text-xl mb-3">âœ… Â¡Endpoint Creado!</h3>
                <div id="resultContent" class="space-y-2"></div>
            </div>

            <!-- Error -->
            <div id="error" class="hidden mt-6 p-6 bg-red-50 border-2 border-red-200 rounded-lg">
                <h3 class="font-bold text-red-800 text-xl mb-3">âŒ Error</h3>
                <p id="errorContent" class="text-red-600"></p>
            </div>
        </div>

        <!-- Endpoints List -->
        <div class="bg-white rounded-2xl shadow-lg p-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold gradient-text">ğŸ“‹ Endpoints Disponibles</h2>
                <button 
                    onclick="cargarEndpoints()"
                    class="bg-purple-100 hover:bg-purple-200 text-purple-700 font-semibold px-4 py-2 rounded-lg transition">
                    ğŸ”„ Actualizar
                </button>
            </div>
            
            <div id="endpointsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Los endpoints se cargarÃ¡n aquÃ­ -->
            </div>
            
            <div id="noEndpoints" class="text-center py-12 text-gray-400">
                <p class="text-xl">ğŸ½ï¸ No hay endpoints aÃºn</p>
                <p class="mt-2">Crea tu primer endpoint arriba</p>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="text-center py-8 text-gray-500">
        <p>Hecho con ğŸŒ¯ y â¤ï¸ usando Gemini AI + Supabase + Railway</p>
    </footer>

    <script>
        const API_URL = window.location.origin;

        function setPrompt(text) {
            document.getElementById('promptInput').value = text;
        }

        async function generarEndpoint() {
            const prompt = document.getElementById('promptInput').value;
            const loading = document.getElementById('loading');
            const result = document.getElementById('result');
            const error = document.getElementById('error');
            const btn = document.getElementById('generateBtn');

            // Validar
            if (prompt.length < 10) {
                error.classList.remove('hidden');
                result.classList.add('hidden');
                document.getElementById('errorContent').textContent = 'El prompt debe tener al menos 10 caracteres';
                return;
            }

            // Mostrar loading
            loading.classList.remove('hidden');
            result.classList.add('hidden');
            error.classList.add('hidden');
            btn.disabled = true;
            btn.textContent = 'â³ Generando...';

            try {
                const response = await fetch(`${API_URL}/api/create-endpoint`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ prompt })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Error al generar endpoint');
                }

                // Mostrar resultado
                loading.classList.add('hidden');
                result.classList.remove('hidden');
                
                const fullUrl = `${API_URL}/api${data.endpoint.path}`;
                document.getElementById('resultContent').innerHTML = `
                    <div class="space-y-3">
                        <div>
                            <span class="font-semibold text-gray-700">MÃ©todo:</span>
                            <span class="ml-2 px-3 py-1 rounded-full text-sm font-semibold ${getMethodColor(data.endpoint.method)}">
                                ${data.endpoint.method}
                            </span>
                        </div>
                        <div>
                            <span class="font-semibold text-gray-700">Ruta:</span>
                            <code class="ml-2 bg-gray-100 px-3 py-1 rounded text-sm">/api${data.endpoint.path}</code>
                        </div>
                        <div>
                            <span class="font-semibold text-gray-700">DescripciÃ³n:</span>
                            <p class="mt-1 text-gray-600">${data.endpoint.description}</p>
                        </div>
                        <div>
                            <span class="font-semibold text-gray-700">URL completa:</span>
                            <div class="mt-2 flex gap-2">
                                <input 
                                    type="text" 
                                    value="${fullUrl}" 
                                    readonly 
                                    class="flex-1 p-2 bg-gray-100 rounded text-sm font-mono"
                                    onclick="this.select()"
                                >
                                <button 
                                    onclick="copyToClipboard('${fullUrl}')"
                                    class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded transition">
                                    ğŸ“‹ Copiar
                                </button>
                            </div>
                        </div>
                        <div class="pt-3">
                            <a 
                                href="${fullUrl}" 
                                target="_blank"
                                class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-3 rounded-lg transition">
                                ğŸ§ª Probar Endpoint â†’
                            </a>
                        </div>
                    </div>
                `;

                // Recargar lista
                setTimeout(() => cargarEndpoints(), 1000);

                // Limpiar input
                document.getElementById('promptInput').value = '';

            } catch (err) {
                loading.classList.add('hidden');
                error.classList.remove('hidden');
                document.getElementById('errorContent').textContent = err.message;
            } finally {
                btn.disabled = false;
                btn.textContent = 'ğŸŒ¯ Generar Endpoint con IA';
            }
        }

        async function cargarEndpoints() {
            try {
                const response = await fetch(`${API_URL}/`);
                const data = await response.json();

                const list = document.getElementById('endpointsList');
                const noEndpoints = document.getElementById('noEndpoints');

                if (data.endpoints && data.endpoints.length > 0) {
                    noEndpoints.classList.add('hidden');
                    list.innerHTML = data.endpoints.map(ep => `
                        <div class="endpoint-card bg-gradient-to-br from-purple-50 to-blue-50 p-5 rounded-xl border-2 border-purple-200">
                            <div class="flex items-center justify-between mb-3">
                                <span class="px-3 py-1 rounded-full text-xs font-bold ${getMethodColor(ep.method)}">
                                    ${ep.method}
                                </span>
                                <span class="text-xs text-gray-500">ID: ${ep.path.split('/').pop()}</span>
                            </div>
                            <code class="text-sm font-mono text-purple-700 font-semibold block mb-2">
                                ${ep.path}
                            </code>
                            <p class="text-sm text-gray-600 mb-4 line-clamp-2">${ep.description}</p>
                            <div class="flex gap-2">
                                <a 
                                    href="${ep.url}" 
                                    target="_blank"
                                    class="flex-1 text-center bg-purple-600 hover:bg-purple-700 text-white text-sm font-semibold py-2 px-3 rounded-lg transition">
                                    ğŸ§ª Probar
                                </a>
                                <button 
                                    onclick="copyToClipboard('${ep.url}')"
                                    class="bg-gray-200 hover:bg-gray-300 text-gray-700 text-sm font-semibold py-2 px-3 rounded-lg transition">
                                    ğŸ“‹
                                </button>
                            </div>
                        </div>
                    `).join('');
                } else {
                    noEndpoints.classList.remove('hidden');
                    list.innerHTML = '';
                }
            } catch (err) {
                console.error('Error cargando endpoints:', err);
            }
        }

        function getMethodColor(method) {
            const colors = {
                'GET': 'bg-green-100 text-green-700',
                'POST': 'bg-blue-100 text-blue-700',
                'PUT': 'bg-yellow-100 text-yellow-700',
                'DELETE': 'bg-red-100 text-red-700'
            };
            return colors[method] || 'bg-gray-100 text-gray-700';
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('âœ… URL copiada al portapapeles');
            });
        }

        // Cargar endpoints al iniciar
        cargarEndpoints();

        // Auto-actualizar cada 30 segundos
        setInterval(cargarEndpoints, 30000);
    </script>
</body>
</html>
